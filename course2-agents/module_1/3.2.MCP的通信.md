## MCP 的通信
>🎯 一句话总结（核心概念）
- `MCP（Model Context Protocol）` 是一套运行在 `JSON-RPC 2.0` 之上的协议
- 它可以通过两种传输方式通信：`STDIO` 与 `WebSocket`
- `HTTP` 和 `SSE` 不承载 `MCP` 消息，但辅助工具、资源、事件等功能

### 🧱 1. MCP（Model Context Protocol）是什么？

- 一套协议：定义 `JSON-RPC` 格式、工具调用、资源访问、事件、能力协商
- 不规定使用哪种底层通讯，只定义消息模式
- 服务端与客户端之间通信依赖传输层：`STDIO` 或 `WebSocket`

##### 📌 MCP 消息 = JSON-RPC 2.0 数据包

### 🔌 2. STDIO 在 MCP 中的角色
##### ✅ STDIO = 本地 MCP Server 的默认通信方式

MCP 客户端通过：
- 将 JSON-RPC 写入服务器 stdin
- 从 stdout 读取 JSON-RPC 响应

>📌 作用
- 主要、本地、默认、不需要网络
- ChatGPT Desktop 优先使用 STDIO
- 官方 Python 与 Node SDK 默认用它

📎 本质：一种最简单的双向字节流传输方式

### 🌐 3. WebSocket 在 MCP 中的角色
✅ WebSocket = 面向“远程 MCP server”的通信方式

它提供：
- 双向通信
- 更适合云端部署
- JSON-RPC 消息通过 WS 帧传输

>📌 作用
- MCP 的第二个正式 transport
- 用于云端工具、远程资源服务器

❗WebSocket 本质上还是基于 HTTP 握手（后面会解释）

### 🌍 4. HTTP 在 MCP 中的角色

HTTP 不是 MCP 的通信协议。
但在 MCP 体系中扮演重要辅助角色：

#### ① WebSocket 的握手协议

WebSocket 必须先通过 HTTP Upgrade 握手。
所以：
```sh
Client → HTTP handshake → Upgrade → WebSocket → MCP JSON-RPC
```

#### ② 作为资源（Resources）的 URI

MCP 资源可以是：
```sh
file://
http://
https://
mcp://
data:// 等
```
客户端可以通过 HTTP 拉取文件内容（例如大 JSON / 文件下载）。

#### ③ 作为工具输出的大文件传输方式

工具调用返回 HTTP URL：
```sh
{"text": "download result at https://example.com/result.csv"}
```
用于绕开 JSON-RPC 的体积限制。

### 📡 5. SSE（Server-Sent Events）在 MCP 中的角色

SSE 也 不是 MCP 消息传输方式，但可用于：

#### ① 推送资源更新事件

例如某个资源（文件 / 文档）更新：
```sh
event: changed
data: {"uri":"https://example.com/doc.md"}
```

#### ② 推送外部数据流

例如：
- 外部传感器事件
- 日志流
- 股票价格流
- 文档监控事件

在 MCP server 内部，可把 SSE 数据转变为 MCP 通知（notifications）。

### 🧩 总体关系图（最清晰版）
```sh
                ┌──────────────────────────────┐
                │         MCP 协议层           │
                │ (JSON-RPC: tools, resources) │
                └──────────────┬───────────────┘
                               │
                  ┌────────────┴────────────┐
                  │                         │
        ┌────────────────┐      ┌──────────────────┐
        │     STDIO      │      │    WebSocket     │
        │ (本地传输层)    │      │ (远程传输层)      │
        └────────────────┘      └──────────────────┘
                                        │
                            ┌───────────┴───────────┐
                            │         HTTP            │
                            │    (WS 握手 / 资源 URL) │
                            └───────────┬───────────┘
                                        │
                                   ┌────┴────┐
                                   │   SSE    │
                                   │ (事件流) │
                                   └─────────┘
```
#### 📝 最终总结（简表）
| 协议            | 作用                                    | 是否用于运送 MCP 消息？ |
| ------------- | ------------------------------------- | -------------- |
| **MCP**       | 协议定义本身（tools/resources/notifications） | ✔（通过 JSON-RPC） |
| **STDIO**     | 本地 transport                          | ✔              |
| **WebSocket** | 远程 transport                          | ✔              |
| **HTTP**      | 辅助 transport（资源/文件/WS 握手）             | ❌              |
| **SSE**       | 事件流来源，例如外部资源变更                        | ❌              |

#### 📌 一句话终极总结

- `STDIO & WebSocket` = MCP 的正式通信方式
- `HTTP & SSE` = 环境集成方式，不是传输 MCP 消息
- `MCP` 本身是协议，不依赖某种底层 transport